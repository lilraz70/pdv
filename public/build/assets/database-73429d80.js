import{F as q}from"./bootstrap-b8cd97d4.js";import{_ as s}from"./currency-dc6217f5.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";import{an as p,af as i,G as o,H as a,A as n,F as c,al as F,z as b,aH as f,am as y,M as P,c as k}from"./npm~@vue~runtime-core_-0a26b3ab.js";import{V as r}from"./npm~@vue~shared_-5bb087a6.js";import"./npm~lodash-3db1c062.js";import"./npm~@ckeditor~ckeditor5-build-classic_-b5d88964.js";import"./npm~laravel-echo-0c2ba8ed.js";import"./npm~pusher-js-bd96ae31.js";import"./npm~axios-c24e582b.js";import"./npm~chart.js-3fed1729.js";import"./npm~rxjs-eeb06f17.js";import"./npm~tslib-8dbab242.js";import"./npm~moment-a9aaa855.js";import"./npm~vue-0182d78b.js";import"./npm~@vue~runtime-dom_-2c8e0ca9.js";import"./npm~@vue~reactivity_-26e9e2f4.js";import"./npm~@vue~compiler-dom_-ce2c1e21.js";import"./npm~@vue~compiler-core_-745c8708.js";import"./npm~rx-f450d610.js";import"./npm~@wordpress~hooks_-bd0b7221.js";import"./npm~mathjs-b10bd4cd.js";import"./npm~@babel~runtime_-9313f80d.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-dc0d19c5.js";import"./npm~fraction.js-cb0643cb.js";import"./npm~typed-function-de33f2d8.js";import"./npm~seedrandom-37239647.js";import"./npm~javascript-natural-sort-11e7fc54.js";import"./npm~escape-latex-404addb9.js";import"./npm~numeral-304d6dd9.js";import"./npm~currency.js-57f74176.js";const C={data:()=>({formValidation:new q,firstPartFields:[],secondPartFields:[],fields:[],isLoading:!1,isCheckingDatabase:!1,__:s}),computed:{form(){return this.formValidation.extractFields([...this.firstPartFields,...this.secondPartFields])},isMySQL(){return this.form.database_driver==="mysql"},isSqlite(){return this.form.database_driver==="sqlite"}},methods:{validate(){if(this.formValidation.validateFields(this.firstPartFields)&&this.formValidation.validateFields(this.secondPartFields)){this.isLoading=!0,this.formValidation.disableFields(this.firstPartFields),this.formValidation.disableFields(this.secondPartFields);const e={...this.formValidation.getValue(this.firstPartFields),...this.formValidation.getValue(this.secondPartFields)};this.checkDatabase(e).subscribe(d=>{this.formValidation.enableFields(this.firstPartFields),this.formValidation.enableFields(this.secondPartFields),nsRouter.push("configuration"),nsSnackBar.success(d.message,s("OKAY"),{duration:5e3}).subscribe()},d=>{this.formValidation.enableFields(this.firstPartFields),this.formValidation.enableFields(this.secondPartFields),this.isLoading=!1,nsSnackBar.error(d.message,s("OKAY")).subscribe()})}},checkDatabase(e){return nsHttpClient.post("/api/setup/database",e)},checkExisting(){return nsHttpClient.get("/api/setup/check-database")},sliceRange(e,l,d){const _=e.length,h=Math.ceil(_/l);return e.splice(d*h,h)},loadFields(){this.fields=this.formValidation.createFields([{label:s("Driver"),description:s("Set the database driver"),name:"database_driver",value:"mysql",type:"select",options:[{label:"MySQL",value:"mysql"},{label:"SQLite",value:"sqlite"}],validation:"required"},{label:s("Hostname"),description:s("Provide the database hostname"),name:"hostname",value:"localhost",show:e=>e.database_driver==="mysql"},{label:s("Username"),description:s("Username required to connect to the database."),name:"username",value:"root",show:e=>e.database_driver==="mysql"},{label:s("Password"),description:s("The username password required to connect."),name:"password",value:"",show:e=>e.database_driver==="mysql"},{label:s("Database Name"),description:s("Provide the database name. Leave empty to use default file for SQLite Driver."),name:"database_name",value:"nexopos_v4",show:e=>e.database_driver==="mysql"},{label:s("Database Prefix"),description:s("Provide the database prefix."),name:"database_prefix",value:"ns_",validation:"required",show:e=>e.database_driver==="mysql"},{label:s("Port"),description:s("Provide the hostname port."),name:"database_port",value:"3306",validation:"required",show:e=>e.database_driver==="mysql"}]),this.firstPartFields=Object.values(this.sliceRange([...this.fields],2,0)),this.secondPartFields=Object.values(this.sliceRange([...this.fields],2,1))}},mounted(){this.isCheckingDatabase=!0,this.checkExisting().subscribe({next:e=>{nsRouter.push("configuration")},error:e=>{this.isCheckingDatabase=!1,this.loadFields()}})}},L={key:0,class:"bg-white rounded shadow my-4"},D={class:"welcome-box border-b border-gray-300 p-3 text-gray-600"},x={class:"border-b pb-4 mb-4"},M={key:0},B={class:"font-bold text-lg"},H={key:1},N={class:"font-bold text-lg"},Q={class:"md:-mx-4 md:flex"},O={class:"md:px-4 md:w-1/2 w-full"},R={class:"md:px-4 md:w-1/2 w-full"},j={class:"bg-gray-200 p-3 flex justify-end"},$={key:1,class:"bg-white shadow rounded p-3 flex justify-center items-center"},z={class:"flex items-center"},A={class:"ml-3"};function E(e,l,d,_,h,m){const v=p("ns-field"),g=p("ns-spinner"),w=p("ns-button");return i(),o(c,null,[e.isCheckingDatabase?n("",!0):(i(),o("div",L,[a("div",D,[a("div",x,[m.isMySQL?(i(),o("div",M,[a("h3",B,r(e.__("MySQL is selected as database driver")),1),a("p",null,r(e.__("Please provide the credentials to ensure NexoPOS can connect to the database.")),1)])):n("",!0),m.isSqlite?(i(),o("div",H,[a("h3",N,r(e.__("Sqlite is selected as database driver")),1),a("p",null,r(e.__("Make sure Sqlite module is available for PHP. Your database will be located on the database directory.")),1)])):n("",!0)]),a("div",Q,[a("div",O,[(i(!0),o(c,null,F(e.firstPartFields,(t,u)=>(i(),o(c,{key:u},[t.show===void 0||t.show!==void 0&&t.show(m.form)?(i(),b(v,{key:0,field:t,onChange:V=>e.formValidation.validateField(t)},{default:f(()=>[a("span",null,r(t.label),1),y(e.$slots,"description",{},()=>[P(r(t.description),1)])]),_:2},1032,["field","onChange"])):n("",!0)],64))),128))]),a("div",R,[(i(!0),o(c,null,F(e.secondPartFields,(t,u)=>(i(),o(c,{key:u},[t.show===void 0||t.show!==void 0&&t.show(m.form)?(i(),b(v,{key:0,field:t,onChange:V=>e.formValidation.validateField(t)},{default:f(()=>[a("span",null,r(t.label),1),y(e.$slots,"description",{},()=>[P(r(t.description),1)])]),_:2},1032,["field","onChange"])):n("",!0)],64))),128))])])]),a("div",j,[k(w,{disabled:e.isLoading,onClick:l[0]||(l[0]=t=>m.validate()),type:"info"},{default:f(()=>[e.isLoading?(i(),b(g,{key:0,class:"mr-2",size:6})):n("",!0),a("span",null,r(e.__("Save Settings")),1)]),_:1},8,["disabled"])])])),e.isCheckingDatabase?(i(),o("div",$,[a("div",z,[k(g,{size:10}),a("span",A,r(e.__("Checking database connectivity...")),1)])])):n("",!0)],64)}const Pe=S(C,[["render",E]]);export{Pe as default};
