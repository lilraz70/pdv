var M=Object.defineProperty;var W=(r,s,n)=>s in r?M(r,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[s]=n;var T=(r,s,n)=>(W(r,typeof s!="symbol"?s+"":s,n),n);import{F as R,e as I,b as p,a as v,p as q,P as A}from"./bootstrap-b8cd97d4.js";import{_ as u,n as V}from"./currency-dc6217f5.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{an as h,af as d,G as c,H as e,c as y,F as x,al as w,z as k,A as m,aH as P,M as j,aJ as D}from"./npm~@vue~runtime-core_-0a26b3ab.js";import{V as i,z as L}from"./npm~@vue~shared_-5bb087a6.js";import{a as Q,n as O,b as z,g as J,d as K}from"./ns-prompt-popup-4f52d15c.js";import"./npm~@dicebear~avatars_-24df7cd3.js";import"./npm~@dicebear~avatars-avataaars-sprites_-796ded10.js";import"./npm~moment-a9aaa855.js";import"./npm~vue2-daterange-picker-c3e32574.js";import"./npm~vuedraggable-45210012.js";import"./npm~vue-upload-component-5c82cdcf.js";import"./npm~lodash-3db1c062.js";import{l as Y,m as B}from"./npm~@vue~runtime-dom_-2c8e0ca9.js";import{f as X}from"./npm~rxjs-eeb06f17.js";const Z={props:["popup"],mounted(){this.popuCloser(),this.loadFields(),this.product=this.popup.params.product},data(){return{formValidation:new R,fields:[],product:null}},methods:{__:u,popuCloser:I,close(){this.popup.params.reject(!1),this.popup.close()},addProduct(){if(this.formValidation.validateFields(this.fields),this.formValidation.fieldsValid(this.fields)){const r=this.formValidation.extractFields(this.fields),s={...this.product,...r};return this.popup.params.resolve(s),this.close()}p.error(u("The form is not valid.")).subscribe()},loadFields(){v.get("/api/fields/ns.refund-product").subscribe(r=>{this.fields=this.formValidation.createFields(r),this.fields.forEach(s=>{s.value=this.product[s.name]||""})})}}},ee={class:"shadow-xl ns-box w-95vw md:w-3/5-screen lg:w-3/7-screen h-95vh md:h-3/5-screen lg:h-3/7-screen overflow-hidden flex flex-col"},se={class:"p-2 flex justify-between border-b ns-box-header items-center"},te={class:"text-semibold"},re={class:"flex-auto overflow-y-auto relative ns-scrollbar"},ne={class:"p-2"},ie={key:0,class:"h-full w-full flex items-center justify-center"},oe={class:"p-2 flex justify-between items-center border-t ns-box-body"},le=e("div",null,null,-1);function de(r,s,n,_,o,t){const b=h("ns-close-button"),l=h("ns-field"),a=h("ns-spinner"),g=h("ns-button");return d(),c("div",ee,[e("div",se,[e("h3",te,i(t.__("Products")),1),e("div",null,[y(b,{onClick:s[0]||(s[0]=f=>t.close())})])]),e("div",re,[e("div",ne,[(d(!0),c(x,null,w(o.fields,(f,C)=>(d(),k(l,{key:C,field:f},null,8,["field"]))),128))]),o.fields.length===0?(d(),c("div",ie,[y(a)])):m("",!0)]),e("div",oe,[le,e("div",null,[y(g,{onClick:s[1]||(s[1]=f=>t.addProduct()),type:"info"},{default:P(()=>[j(i(t.__("Add Product")),1)]),_:1})])])])}const G=F(Z,[["render",de]]),ae={components:{nsNumpad:Q},props:["popup"],data(){return{product:null,seeValue:0,availableQuantity:0}},mounted(){this.product=this.popup.params.product,this.availableQuantity=this.popup.params.availableQuantity,this.seeValue=this.product.quantity},methods:{__:u,popupResolver:q,close(){this.popup.params.reject(!1),this.popup.close()},setChangedValue(r){this.seeValue=r},updateQuantity(r){if(r>this.availableQuantity)return p.error("Unable to proceed as the quantity provided is exceed the available quantity.").subscribe();this.product.quantity=parseFloat(r),this.popup.params.resolve(this.product),this.popup.close()}}},ce={class:"shadow-xl ns-box overflow-hidden w-95vw md:w-4/6-screen lg:w-3/7-screen"},ue={class:"p-2 flex justify-between ns-box-header"},_e={class:"font-semibold"},me={key:0,class:"border-t border-b ns-box-body py-2 flex items-center justify-center text-2xl font-semibold"},pe={class:"text-primary text-sm"},fe={key:1,class:"flex-auto overflow-y-auto p-2"};function he(r,s,n,_,o,t){const b=h("ns-close-button"),l=h("ns-numpad");return d(),c("div",ce,[e("div",ue,[e("h3",_e,i(t.__("Quantity")),1),e("div",null,[y(b,{onClick:s[0]||(s[0]=a=>t.close())})])]),o.product?(d(),c("div",me,[e("span",null,i(o.seeValue),1),e("span",pe,"("+i(o.availableQuantity)+" "+i(t.__("available"))+")",1)])):m("",!0),o.product?(d(),c("div",fe,[y(l,{value:o.product.quantity,onNext:s[1]||(s[1]=a=>t.updateQuantity(a)),onChanged:s[2]||(s[2]=a=>t.setChangedValue(a))},null,8,["value"])])):m("",!0)])}const be=F(ae,[["render",he]]);class U{constructor({urls:s,options:n}){T(this,"urls");T(this,"options");T(this,"printingURL",{refund:"refund_printing_url",sale:"sale_printing_url",payment:"payment_printing_url"});this.urls=s,this.options=n}processRegularPrinting(s,n){const _=document.querySelector("#printing-section");_&&_.remove();const o=this.urls[this.printingURL[n]].replace("{reference_id}",s),t=document.createElement("iframe");t.id="printing-section",t.className="hidden",t.src=o,document.body.appendChild(t),setTimeout(()=>{document.querySelector("#printing-section").remove()},5e3)}process(s,n,_="aloud"){switch(this.options.ns_pos_printing_gateway){case"default":this.processRegularPrinting(s,n);break;default:this.processCustomPrinting(s,this.options.ns_pos_printing_gateway,n,_);break}}processCustomPrinting(s,n,_,o="aloud"){const t={printed:!1,reference_id:s,gateway:n,document:_,mode:o};nsHooks.applyFilters("ns-custom-print",{params:t,promise:()=>new Promise((l,a)=>{a({status:"failed",message:__("The selected print gateway doesn't support this type of printing.","NsPrintAdapter")})})}).promise().then(l=>{nsSnackBar.success(l.message).subscribe()}).catch(l=>{nsSnackBar.error(l.message||__("An error unexpected occured while printing.")).subscribe()})}}const ye={components:{nsNumpad:Q},props:["order"],computed:{total(){return this.refundables.length>0?this.refundables.map(r=>parseFloat(r.unit_price)*parseFloat(r.quantity)).reduce((r,s)=>r+s)+this.shippingFees:0+this.shippingFees},shippingFees(){return this.refundShipping?this.order.shipping:0}},data(){return{isSubmitting:!1,formValidation:new R,refundables:[],paymentOptions:[],paymentField:[],print:new U({urls:systemUrls,options:systemOptions}),refundShipping:!1,selectedPaymentGateway:!1,screen:0,selectFields:[{type:"select",options:this.order.products.map(r=>({label:`${r.name} - ${r.unit.name} (x${r.quantity})`,value:r.id})),validation:"required",name:"product_id",label:u("Product"),description:u("Select the product to perform a refund.")}]}},methods:{__:u,nsCurrency:V,updateScreen(r){this.screen=r},toggleRefundShipping(r){this.refundShipping=r,this.refundShipping},proceedPayment(){if(this.selectedPaymentGateway===!1)return p.error(u("Please select a payment gateway before proceeding.")).subscribe();if(this.total===0)return p.error(u("There is nothing to refund.")).subscribe();if(this.screen===0)return p.error(u("Please provide a valid payment amount.")).subscribe();A.show(O,{title:u("Confirm Your Action"),message:u("The refund will be made on the current order."),onAction:r=>{r&&this.doProceed()}})},doProceed(){const r={products:this.refundables,total:this.screen,payment:{identifier:this.selectedPaymentGateway},refund_shipping:this.refundShipping};this.isSubmitting=!0,v.post(`/api/orders/${this.order.id}/refund`,r).subscribe({next:s=>{this.isSubmitting=!1,this.$emit("changed",!0),s.data.order.payment_status==="refunded"&&this.$emit("loadTab","details"),this.print.process(s.data.orderRefund.id,"refund"),p.success(s.message).subscribe()},error:s=>{this.isSubmitting=!1,p.error(s.message).subscribe()}})},addProduct(){if(this.formValidation.validateFields(this.selectFields),!this.formValidation.fieldsValid(this.selectFields))return p.error(u("Please select a product before proceeding.")).subscribe();const r=this.formValidation.extractFields(this.selectFields),s=this.order.products.filter(t=>t.id===r.product_id),n=this.refundables.filter(t=>t.id===r.product_id);if(n.length>0&&n.map(b=>parseInt(b.quantity)).reduce((b,l)=>b+l)===s[0].quantity)return p.error(u("Not enough quantity to proceed.")).subscribe();if(s[0].quantity===0)return p.error(u("Not enough quantity to proceed.")).subscribe();const _={...s[0],condition:"",description:""};new Promise((t,b)=>{A.show(G,{resolve:t,reject:b,product:_})}).then(t=>{t.quantity=this.getProductOriginalQuantity(t.id)-this.getProductUsedQuantity(t.id),this.refundables.push(t)},t=>t)},getProductOriginalQuantity(r){const s=this.order.products.filter(n=>n.id===r);return s.length>0?s.map(n=>parseFloat(n.quantity)).reduce((n,_)=>n+_):0},getProductUsedQuantity(r){const s=this.refundables.filter(n=>n.id===r);return s.length>0?s.map(_=>parseFloat(_.quantity)).reduce((_,o)=>_+o):0},openSettings(r){new Promise((n,_)=>{A.show(G,{resolve:n,reject:_,product:r})}).then(n=>{const _=this.refundables.indexOf(r);this.$set(this.refundables,_,n)},n=>n)},async selectPaymentGateway(){try{this.selectedPaymentGateway=await new Promise((r,s)=>{A.show(z,{resolve:r,reject:s,value:[this.selectedPaymentOption],...this.paymentField[0]})}),this.selectedPaymentGatewayLabel=this.paymentField[0].options.filter(r=>r.value===this.selectedPaymentGateway)[0].label}catch{p.error(u("An error has occured while seleting the payment gateway.")).subscribe()}},changeQuantity(r){new Promise((n,_)=>{const o=this.getProductOriginalQuantity(r.id)-this.getProductUsedQuantity(r.id)+parseFloat(r.quantity);A.show(be,{resolve:n,reject:_,product:r,availableQuantity:o})}).then(n=>{if(n.quantity>this.getProductUsedQuantity(r.id)-r.quantity){const _=this.refundables.indexOf(r);this.$set(this.refundables,_,n)}})},deleteProduct(r){new Promise((s,n)=>{A.show(O,{title:u("Confirm Your Action"),message:u("Would you like to delete this product ?"),onAction:_=>{if(_){const o=this.refundables.indexOf(r);this.refundables.splice(o,1)}}})})}},mounted(){this.selectFields=this.formValidation.createFields(this.selectFields),v.get("/api/orders/payments").subscribe(r=>{this.paymentField=r})}},ve={class:"-m-4 flex-auto flex flex-wrap relative"},xe={key:0,class:"bg-overlay h-full w-full flex items-center justify-center absolute z-30"},we={class:"px-4 w-full lg:w-1/2"},ge={class:"py-2 border-b-2 text-primary border-info-primary"},ke={class:"my-2"},Pe={class:"border-b border-info-primary flex justify-between items-center mb-2"},Ce={class:"flex-auto flex-col flex"},Se={class:"p-2 flex"},je={class:"flex justify-between p-2"},Oe={class:"flex items-center text-primary"},Ae={key:0,class:"mr-2"},Fe={class:"py-1 border-b-2 text-primary border-info-primary"},Ve={class:"px-2 text-primary flex justify-between flex-auto"},Ue={class:"flex flex-col"},Te={class:"py-2"},De={key:0,class:"rounded-full px-2 py-1 text-xs bg-error-tertiary mx-2 text-white"},Re={key:1,class:"rounded-full px-2 py-1 text-xs bg-success-tertiary mx-2 text-white"},Ie={class:"flex items-center justify-center"},qe={class:"py-1 flex items-center cursor-pointer border-b border-dashed border-info-primary"},$e={class:"flex"},Qe=["onClick"],Ne=e("i",{class:"las la-cog text-xl"},null,-1),Ye=[Ne],Be=["onClick"],Ge=e("i",{class:"las la-trash"},null,-1),Le=[Ge],Ee=["onClick"],He={class:"px-4 w-full lg:w-1/2"},Me={class:"py-2 border-b-2 text-primary border-info-primary"},We={class:"py-2"},ze={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"},Je={class:"elevation-surface border success font-semibold flex mb-2 p-2 justify-between"},Ke={class:"elevation-surface border font-semibold flex mb-2 p-2 justify-between"};function Xe(r,s,n,_,o,t){const b=h("ns-spinner"),l=h("ns-field"),a=h("ns-checkbox"),g=h("ns-numpad-plus");return d(),c("div",ve,[o.isSubmitting?(d(),c("div",xe,[y(b)])):m("",!0),e("div",we,[e("h3",ge,i(t.__("Refund With Products")),1),e("div",ke,[e("ul",null,[e("li",Pe,[e("div",Ce,[e("div",Se,[(d(!0),c(x,null,w(o.selectFields,(f,C)=>(d(),k(l,{field:f,key:C},null,8,["field"]))),128))]),e("div",je,[e("div",Oe,[n.order.shipping>0?(d(),c("span",Ae,i(t.__("Refund Shipping")),1)):m("",!0),n.order.shipping>0?(d(),k(a,{key:1,onChange:s[0]||(s[0]=f=>t.toggleRefundShipping(f)),checked:o.refundShipping},null,8,["checked"])):m("",!0)]),e("div",null,[e("button",{onClick:s[1]||(s[1]=f=>t.addProduct()),class:"border rounded-full px-2 py-1 ns-inset-button info"},i(t.__("Add Product")),1)])])])]),e("li",null,[e("h4",Fe,i(t.__("Products")),1)]),(d(!0),c(x,null,w(o.refundables,f=>(d(),c("li",{key:f.id,class:"elevation-surface border flex justify-between items-center mb-2"},[e("div",Ve,[e("div",Ue,[e("p",Te,[e("span",null,i(f.name),1),f.condition==="damaged"?(d(),c("span",De,i(t.__("Damaged")),1)):m("",!0),f.condition==="unspoiled"?(d(),c("span",Re,i(t.__("Unspoiled")),1)):m("",!0)]),e("small",null,i(f.unit.name),1)]),e("div",Ie,[e("span",qe,i(t.nsCurrency(f.unit_price*f.quantity)),1)])]),e("div",$e,[e("p",{onClick:C=>t.openSettings(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},Ye,8,Qe),e("p",{onClick:C=>t.deleteProduct(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},Le,8,Be),e("p",{onClick:C=>t.changeQuantity(f),class:"p-2 border-l border-info-primary cursor-pointer text-primary ns-numpad-key w-16 h-16 flex items-center justify-center"},i(f.quantity),9,Ee)])]))),128))])])]),e("div",He,[e("h3",Me,i(t.__("Summary")),1),e("div",We,[e("div",ze,[e("span",null,i(t.__("Total")),1),e("span",null,i(t.nsCurrency(t.total)),1)]),e("div",Je,[e("span",null,i(t.__("Paid")),1),e("span",null,i(t.nsCurrency(n.order.tendered)),1)]),e("div",{onClick:s[2]||(s[2]=f=>t.selectPaymentGateway()),class:"elevation-surface border info font-semibold flex mb-2 p-2 justify-between cursor-pointer"},[e("span",null,i(t.__("Payment Gateway")),1),e("span",null,i(o.selectedPaymentGateway?r.selectedPaymentGatewayLabel:"N/A"),1)]),e("div",Ke,[e("span",null,i(t.__("Screen")),1),e("span",null,i(t.nsCurrency(o.screen)),1)]),e("div",null,[y(g,{currency:!0,onChanged:s[3]||(s[3]=f=>t.updateScreen(f)),value:o.screen,onNext:s[4]||(s[4]=f=>t.proceedPayment(f))},null,8,["value"])])])])])}const Ze=F(ye,[["render",Xe]]);class N{getTypeLabel(s){const n=typeLabels.filter(_=>_.value===s);return n.length>0?n[0].label:u("Unknown Status")}getDeliveryStatus(s){const n=deliveryStatuses.filter(_=>_.value===s);return n.length>0?n[0].label:u("Unknown Status")}getProcessingStatus(s){const n=processingStatuses.filter(_=>_.value===s);return n.length>0?n[0].label:u("Unknown Status")}getPaymentStatus(s){const n=paymentLabels.filter(_=>_.value===s);return n.length>0?n[0].label:u("Unknown Status")}}const es={props:["order"],data(){return{labels:new N,validation:new R,inputValue:0,print:new U({urls:systemUrls,options:systemOptions}),fields:[],paymentTypes}},computed:{paymentsLabels(){const r=new Object;return this.paymentTypes.forEach(s=>{r[s.value]=s.label}),r}},methods:{__:u,nsCurrency:V,updateValue(r){this.inputValue=r},loadPaymentFields(){v.get("/api/orders/payments").subscribe(r=>{this.fields=this.validation.createFields(r)})},printPaymentReceipt(r){this.print.process(r.id,"payment")},submitPayment(r){if(this.validation.validateFields(this.fields),!this.validation.fieldsValid(this.fields))return p.error(u("Unable to proceed the form is not valid")).subscribe();if(parseFloat(r)==0)return p.error(u("Please provide a valid value")).subscribe();r=parseFloat(r);const s={...this.validation.extractFields(this.fields),value:r};Popup.show(O,{title:u("Confirm Your Action"),message:u("You make a payment for {amount}. A payment can't be canceled. Would you like to proceed ?").replace("{amount}",V(r)),onAction:n=>{n&&v.post(`/api/orders/${this.order.id}/payments`,s).subscribe(_=>{p.success(_.message).subscribe(),this.$emit("changed")},_=>{p.error(_.message).subscribe()})}})}},components:{nsNumpad:Q},mounted(){this.loadPaymentFields()}},ss={class:""},ts={class:"flex -mx-4 flex-wrap"},rs={class:"px-2 w-full md:w-1/2"},is={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface info border text-xl font-bold"},os={class:"px-2 w-full md:w-1/2"},ls={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface success border text-xl font-bold"},ds={class:"px-2 w-full md:w-1/2"},as={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface error border text-xl font-bold"},cs={key:0},us={key:1},_s={class:"px-2 w-full md:w-1/2"},ms={class:"my-1 h-12 py-1 px-2 flex justify-between items-center elevation-surface warning border text-xl font-bold"},ps={class:"flex -mx-4 flex-wrap"},fs={class:"px-2 w-full mb-4 md:w-1/2"},hs={key:0},bs={class:"font-semibold border-b-2 border-info-primary py-2"},ys={class:"py-2"},vs={class:"my-2 px-2 h-12 flex justify-end items-center border elevation-surface"},xs={key:1,class:"flex items-center justify-center h-full"},ws={class:"text-primary font-semibold"},gs={class:"px-2 w-full mb-4 md:w-1/2"},ks={class:"font-semibold border-b-2 border-info-primary py-2 mb-2"},Ps={class:"flex items-center"},Cs=["onClick"],Ss=e("i",{class:"las la-print"},null,-1),js=[Ss];function Os(r,s,n,_,o,t){const b=h("ns-field"),l=h("ns-numpad-plus");return d(),c("div",ss,[e("div",ts,[e("div",rs,[e("div",is,[e("span",null,i(t.__("Total")),1),e("span",null,i(t.nsCurrency(n.order.total)),1)])]),e("div",os,[e("div",ls,[e("span",null,i(t.__("Paid")),1),e("span",null,i(t.nsCurrency(n.order.tendered)),1)])]),e("div",ds,[e("div",as,[e("span",null,i(t.__("Unpaid")),1),n.order.total-n.order.tendered>0?(d(),c("span",cs,i(t.nsCurrency(n.order.total-n.order.tendered)),1)):m("",!0),n.order.total-n.order.tendered<=0?(d(),c("span",us,i(t.nsCurrency(0)),1)):m("",!0)])]),e("div",_s,[e("div",ms,[e("span",null,i(t.__("Customer Account")),1),e("span",null,i(t.nsCurrency(n.order.customer.account_amount)),1)])])]),e("div",ps,[e("div",fs,[n.order.payment_status!=="paid"?(d(),c("div",hs,[e("h3",bs,i(t.__("Payment")),1),e("div",ys,[(d(!0),c(x,null,w(o.fields,(a,g)=>(d(),k(b,{field:a,key:g},null,8,["field"]))),128)),e("div",vs,i(t.nsCurrency(o.inputValue)),1),y(l,{floating:!0,onNext:s[0]||(s[0]=a=>t.submitPayment(a)),onChanged:s[1]||(s[1]=a=>t.updateValue(a)),value:o.inputValue},null,8,["value"])])])):m("",!0),n.order.payment_status==="paid"?(d(),c("div",xs,[e("h3",ws,i(t.__("No payment possible for paid order.")),1)])):m("",!0)]),e("div",gs,[e("h3",ks,i(t.__("Payment History")),1),e("ul",null,[(d(!0),c(x,null,w(n.order.payments,a=>(d(),c("li",{key:a.id,class:"p-2 flex items-center justify-between text-shite border elevation-surface mb-2"},[e("span",Ps,[e("a",{href:"javascript:void(0)",onClick:g=>t.printPaymentReceipt(a),class:"m-1 rounded-full hover:bg-info-tertiary hover:text-white flex items-center justify-center h-8 w-8"},js,8,Cs),j(" "+i(t.paymentsLabels[a.identifier]||t.__("Unknown")),1)]),e("span",null,i(t.nsCurrency(a.value)),1)]))),128))])])])])}const As=F(es,[["render",Os]]),Fs={name:"ns-orders-refund-popup",props:["popup"],data(){return{order:null,refunds:[],view:"summary",previewed:null,loaded:!1,options:systemOptions,systemUrls,print:new U({urls:systemUrls,options:systemOptions})}},methods:{__:u,nsCurrency:V,popupCloser:I,popupResolver:q,toggleProductView(r){this.view="details",this.previewed=r},loadOrderRefunds(){nsHttpClient.get(`/api/orders/${this.order.id}/refunds`).subscribe(r=>{this.loaded=!0,this.refunds=r.refunds},r=>{p.error(r.message).subscribe()})},close(){this.popup.close()},printRefundReceipt(r){this.print.process(r.id,"refund")}},mounted(){this.order=this.popup.params.order,this.popupCloser(),this.loadOrderRefunds()}},Vs={class:"shadow-lg w-95vw h-95vh md:w-3/5-screen md:h-3/5-screen ns-box flex flex-col overflow-hidden"},Us={class:"border-b p-2 flex items-center justify-between ns-box-header"},Ts={class:"flex"},Ds={class:"overflow-auto flex-auto ns-box-body"},Rs={key:0,class:"flex h-full w-full items-center justify-center"},Is={key:1,class:"flex h-full w-full items-center flex-col justify-center"},qs=e("i",{class:"las la-laugh-wink text-4xl"},null,-1),$s={class:"text-sm text-soft-primary text-center"},Qs={class:"w-full md:flex-auto p-2"},Ns={class:"font-semibold mb-1"},Ys={class:"flex -mx-1 text-sm text-primary"},Bs={class:"px-1"},Gs={class:"px-1"},Ls=["onClick"],Es=e("i",{class:"las la-eye"},null,-1),Hs=[Es],Ms=["onClick"],Ws=e("i",{class:"las la-print"},null,-1),zs=[Ws],Js={class:"w-full md:flex-auto p-2"},Ks={class:"font-semibold mb-1"},Xs={class:"flex -mx-1 text-sm text-primary"},Zs={class:"px-1"},et={class:"px-1"},st={class:"px-1"};function tt(r,s,n,_,o,t){const b=h("ns-close-button"),l=h("ns-spinner");return d(),c("div",Vs,[e("div",Us,[e("h3",null,i(t.__("Order Refunds")),1),e("div",Ts,[o.view==="details"?(d(),c("div",{key:0,onClick:s[0]||(s[0]=a=>o.view="summary"),class:"flex items-center justify-center cursor-pointer rounded-full px-3 border ns-inset-button mr-1"},i(t.__("Go Back")),1)):m("",!0),y(b,{onClick:s[1]||(s[1]=a=>t.close())})])]),e("div",Ds,[o.view==="summary"?(d(),c(x,{key:0},[o.loaded?m("",!0):(d(),c("div",Rs,[y(l,{size:"24"})])),o.loaded&&o.refunds.length===0?(d(),c("div",Is,[qs,e("p",$s,i(t.__("No refunds made so far. Good news right?")),1)])):m("",!0),o.loaded&&o.refunds.length>0?(d(!0),c(x,{key:2},w(o.refunds,a=>(d(),c("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:a.id},[e("div",Qs,[e("h3",Ns,i(o.order.code),1),e("div",null,[e("ul",Ys,[e("li",Bs,i(t.__("Total"))+" : "+i(t.nsCurrency(a.total)),1),e("li",Gs,i(t.__("By"))+" : "+i(a.author.username),1)])])]),e("div",{onClick:g=>t.toggleProductView(a),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},Hs,8,Ls),e("div",{onClick:g=>t.printRefundReceipt(a),class:"w-full md:w-16 cursor-pointer hover:bg-info-secondary hover:border-info-primary hover:text-white text-lg flex items-center justify-center border-box-edge md:border-l"},zs,8,Ms)]))),128)):m("",!0)],64)):m("",!0),o.view==="details"?(d(!0),c(x,{key:1},w(o.previewed.refunded_products,a=>(d(),c("div",{class:"border-b border-box-edge flex flex-col md:flex-row",key:a.id},[e("div",Js,[e("h3",Ks,i(a.product.name),1),e("div",null,[e("ul",Xs,[e("li",Zs,i(t.__("Condition"))+" : "+i(a.condition),1),e("li",et,i(t.__("Quantity"))+" : "+i(a.quantity),1),e("li",st,i(t.__("Total"))+" : "+i(t.nsCurrency(a.total_price)),1)])])])]))),128)):m("",!0)])])}const rt=F(Fs,[["render",tt]]),nt={props:["order"],data(){return{processingStatuses,deliveryStatuses,labels:new N,showProcessingSelect:!1,showDeliverySelect:!1,systemUrls}},mounted(){},methods:{__:u,nsCurrency:V,submitProcessingChange(){A.show(O,{title:u("Would you proceed ?"),message:u("The processing status of the order will be changed. Please confirm your action."),onAction:r=>{r&&v.post(`/api/orders/${this.order.id}/processing`,{process_status:this.order.process_status}).subscribe({next:s=>{this.showProcessingSelect=!1,p.success(s.message).subscribe()},error:s=>{p.error(s.message||u("Unexpected error occurred.")).subscribe()}})}})},openRefunds(){try{const r=new Promise((s,n)=>{const _=this.order;A.show(rt,{order:_,resolve:s,reject:n})})}catch{}},submitDeliveryStatus(){A.show(O,{title:u("Would you proceed ?"),message:u("The delivery status of the order will be changed. Please confirm your action."),onAction:r=>{r&&v.post(`/api/orders/${this.order.id}/delivery`,{delivery_status:this.order.delivery_status}).subscribe({next:s=>{this.showDeliverySelect=!1,p.success(s.message).subscribe()},error:s=>{p.error(s.message||u("Unexpected error occurred.")).subscribe()}})}})}}},it={class:"-mx-4 flex flex-wrap"},ot={class:"flex-auto"},lt={class:"w-full mb-2 flex-wrap flex"},dt={class:"w-full mb-2 px-4"},at={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},ct={class:"mb-2 w-full md:w-1/2 px-4"},ut={class:"elevation-surface border p-2 flex justify-between items-start"},_t={class:"text-semibold text-primary"},mt={class:"font-semibold text-secondary"},pt={class:"mb-2 w-full md:w-1/2 px-4"},ft={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},ht={class:"text-semibold"},bt={class:""},yt={key:0,class:"ml-1"},vt={key:1,class:"ml-1"},xt={class:"font-semibold text-primary"},wt={class:"mb-2 w-full md:w-1/2 px-4"},gt={class:"p-2 flex justify-between items-start elevation-surface border"},kt={class:"text-semibold text-primary"},Pt={class:"font-semibold text-secondary"},Ct={class:"mb-2 w-full md:w-1/2 px-4"},St={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},jt={class:"text-semibold"},Ot={class:"font-semibold text-primary"},At={class:"mb-2 w-full md:w-1/2 px-4"},Ft={class:"p-2 flex justify-between items-start border ns-notice success"},Vt={class:"text-semibold"},Ut={class:"font-semibold text-primary"},Tt={class:"mb-2 w-full md:w-1/2 px-4"},Dt={class:"p-2 flex justify-between items-start text-primary elevation-surface info border"},Rt={class:"text-semibold"},It={class:"font-semibold"},qt={class:"mb-2 w-full md:w-1/2 px-4"},$t={class:"p-2 flex justify-between items-start text-primary elevation-surface error border"},Qt={class:"text-semibold"},Nt={class:"font-semibold"},Yt={class:"mb-2 w-full md:w-1/2 px-4"},Bt={class:"p-2 flex justify-between items-start elevation-surface border"},Gt={class:"text-semibold"},Lt={class:"font-semibold"},Et={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},Ht={class:"mb-2"},Mt={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},Wt={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},zt={class:"text-semibold text-primary"},Jt={key:0,class:"font-semibold text-secondary"},Kt=["href"],Xt={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},Zt={class:"text-semibold text-primary"},er={class:"font-semibold text-secondary"},sr={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},tr={class:"text-semibold text-primary"},rr={class:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},nr={class:"w-full text-center"},ir={key:0,class:"flex-auto flex"},or={class:"ns-select flex items-center justify-center"},lr=["value"],dr={class:"pl-2 flex"},ar={class:"mb-2 p-2 flex flex-col md:flex-row justify-between items-center elevation-surface border"},cr={class:"text-semibold text-primary"},ur={class:"font-semibold text-secondary mt-2 md:mt-0 w-full md:w-auto"},_r={class:"w-full text-center"},mr={key:0,class:"flex-auto flex"},pr={class:"ns-select flex items-center justify-center"},fr=["value"],hr={class:"pl-2 flex"},br={class:"mb-2 p-2 flex justify-between items-start elevation-surface border"},yr={class:"text-semibold text-primary"},vr={class:"font-semibold text-secondary"},xr={class:"px-4 w-full md:w-1/2 lg:w-2/4 mb-2"},wr={class:"mb-2"},gr={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},kr={class:"text-semibold text-primary"},Pr={class:"text-secondary text-sm"},Cr={class:"font-semibold text-secondary"},Sr={class:"mb-2"},jr={class:"font-semibold text-secondary pb-2 border-b border-info-primary flex justify-between"},Or={class:"text-semibold text-primary"},Ar={class:"text-secondary text-sm"},Fr={class:"font-semibold text-secondary"};function Vr(r,s,n,_,o,t){const b=h("ns-close-button");return d(),c("div",it,[e("div",ot,[e("div",lt,[e("div",dt,[e("h3",at,i(t.__("Payment Summary")),1)]),e("div",ct,[e("div",ut,[e("div",null,[e("h4",_t,i(t.__("Sub Total")),1)]),e("div",mt,i(t.nsCurrency(n.order.subtotal)),1)])]),e("div",pt,[e("div",ft,[e("div",null,[e("h4",ht,[e("span",bt,i(t.__("Discount")),1),n.order.discount_type==="percentage"?(d(),c("span",yt,"("+i(n.order.discount_percentage)+"%)",1)):m("",!0),n.order.discount_type==="flat"?(d(),c("span",vt,"(Flat)")):m("",!0)])]),e("div",xt,i(t.nsCurrency(n.order.discount)),1)])]),e("div",wt,[e("div",gt,[e("div",null,[e("h4",kt,i(t.__("Shipping")),1)]),e("div",Pt,i(t.nsCurrency(n.order.shipping)),1)])]),e("div",Ct,[e("div",St,[e("div",null,[e("h4",jt,i(t.__("Coupons")),1)]),e("div",Ot,i(t.nsCurrency(n.order.total_coupons)),1)])]),e("div",At,[e("div",Ft,[e("div",null,[e("h4",Vt,i(t.__("Total")),1)]),e("div",Ut,i(t.nsCurrency(n.order.total)),1)])]),e("div",Tt,[e("div",Dt,[e("div",null,[e("h4",Rt,i(t.__("Taxes")),1)]),e("div",It,i(t.nsCurrency(n.order.tax_value)),1)])]),e("div",qt,[e("div",$t,[e("div",null,[e("h4",Qt,i(t.__("Change")),1)]),e("div",Nt,i(t.nsCurrency(n.order.change)),1)])]),e("div",Yt,[e("div",Bt,[e("div",null,[e("h4",Gt,i(t.__("Paid")),1)]),e("div",Lt,i(t.nsCurrency(n.order.tendered)),1)])])])]),e("div",Et,[e("div",Ht,[e("h3",Mt,i(t.__("Order Status")),1)]),e("div",Wt,[e("div",null,[e("h4",zt,[e("span",null,i(t.__("Customer")),1)])]),n.order?(d(),c("div",Jt,[e("a",{class:"border-b border-dashed border-info-primary",href:o.systemUrls.customer_edit_url.replace("#customer",n.order.customer.id),target:"_blank",rel:"noopener noreferrer"},i(n.order.customer.first_name)+" "+i(n.order.customer.last_name),9,Kt)])):m("",!0)]),e("div",Xt,[e("div",null,[e("h4",Zt,[e("span",null,i(t.__("Type")),1)])]),e("div",er,i(o.labels.getTypeLabel(n.order.type)),1)]),e("div",sr,[e("div",null,[e("h4",tr,[e("span",null,i(t.__("Delivery Status")),1)])]),e("div",rr,[e("div",nr,[o.showDeliverySelect?m("",!0):(d(),c("span",{key:0,onClick:s[0]||(s[0]=l=>o.showDeliverySelect=!0),class:"font-semibold text-secondary border-b border-info-primary cursor-pointer border-dashed"},i(o.labels.getDeliveryStatus(n.order.delivery_status)),1))]),o.showDeliverySelect?(d(),c("div",ir,[e("div",or,[D(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":s[1]||(s[1]=l=>n.order.delivery_status=l)},[(d(!0),c(x,null,w(o.deliveryStatuses,(l,a)=>(d(),c("option",{key:a,value:l.value},i(l.label),9,lr))),128))],512),[[Y,n.order.delivery_status]])]),e("div",dr,[y(b,{onClick:s[2]||(s[2]=l=>o.showDeliverySelect=!1)}),e("button",{onClick:s[3]||(s[3]=l=>t.submitDeliveryStatus(n.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},i(t.__("Save")),1)])])):m("",!0)])]),e("div",ar,[e("div",null,[e("h4",cr,[e("span",null,i(t.__("Processing Status")),1)])]),e("div",ur,[e("div",_r,[o.showProcessingSelect?m("",!0):(d(),c("span",{key:0,onClick:s[4]||(s[4]=l=>o.showProcessingSelect=!0),class:"border-b border-info-primary cursor-pointer border-dashed"},i(o.labels.getProcessingStatus(n.order.process_status)),1))]),o.showProcessingSelect?(d(),c("div",mr,[e("div",pr,[D(e("select",{ref:"process_status",class:"flex-auto border-info-primary rounded-lg","onUpdate:modelValue":s[5]||(s[5]=l=>n.order.process_status=l)},[(d(!0),c(x,null,w(o.processingStatuses,(l,a)=>(d(),c("option",{key:a,value:l.value},i(l.label),9,fr))),128))],512),[[Y,n.order.process_status]])]),e("div",hr,[y(b,{onClick:s[6]||(s[6]=l=>o.showProcessingSelect=!1)}),e("button",{onClick:s[7]||(s[7]=l=>t.submitProcessingChange(n.order)),class:"bg-success-primary text-white rounded-full px-2 py-1"},i(t.__("Save")),1)])])):m("",!0)])]),e("div",br,[e("div",null,[e("h4",yr,[e("span",null,i(t.__("Payment Status")),1)])]),e("div",vr,i(o.labels.getPaymentStatus(n.order.payment_status)),1)])]),e("div",xr,[e("div",wr,[e("h3",gr,i(t.__("Products")),1)]),(d(!0),c(x,null,w(n.order.products,l=>(d(),c("div",{key:l.id,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",kr,i(l.name)+" (x"+i(l.quantity)+")",1),e("p",Pr,i(l.unit.name||"N/A"),1)]),e("div",Cr,i(t.nsCurrency(l.total_price)),1)]))),128)),e("div",Sr,[e("h3",jr,[e("span",null,i(t.__("Refunded Products")),1),e("a",{href:"javascript:void(0)",onClick:s[8]||(s[8]=l=>t.openRefunds()),class:"border-b border-info-primary border-dashed"},i(t.__("All Refunds")),1)])]),(d(!0),c(x,null,w(n.order.refunded_products,(l,a)=>(d(),c("div",{key:a,class:"p-2 flex justify-between items-start elevation-surface border mb-6"},[e("div",null,[e("h4",Or,i(l.order_product.name)+" (x"+i(l.quantity)+")",1),e("p",Ar,[j(i(l.unit.name||"N/A")+" | ",1),e("span",{class:L(["rounded-full px-2",l.condition==="damaged"?"bg-error-tertiary text-white":"bg-info-tertiary text-white"])},i(l.condition),3)])]),e("div",Fr,i(t.nsCurrency(l.total_price)),1)]))),128))])])}const Ur=F(nt,[["render",Vr]]),Tr={name:"ns-order-instalments-payment",props:["popup"],components:{nsNotice:J},data(){return{paymentTypes,fields:[{type:"select",name:"payment_type",description:u("Select the payment type that must apply to the current order."),label:u("Payment Type"),validation:"required",options:paymentTypes}],print:new U({urls:systemUrls,options:systemOptions}),validation:new R,order:null,instalment:null}},methods:{__:u,popupResolver:q,popupCloser:I,close(){this.popupResolver(!1)},updateInstalmentAsDue(r){nsHttpClient.put(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/`,{instalment:{date:ns.date.moment.format("YYYY-MM-DD HH:mm:ss")}}).subscribe({next:s=>{this.submitPayment()},error:s=>{p.error(s.message||u("An unexpected error has occurred")).subscribe()}})},submitPayment(){if(!this.validation.validateFields(this.fields))return p.error(__m("The form is not valid.")).subcribe();nsHttpClient.post(`/api/orders/${this.order.id}/instalments/${this.instalment.id}/pay`,{...this.validation.extractFields(this.fields)}).subscribe({next:r=>{this.popupResolver(!0),this.print.exec(r.data.payment.id,"payment"),p.success(r.message).subscribe()},error:r=>{r.status==="failed"&&Popup.show(O,{title:u("Update Instalment Date"),message:u("Would you like to mark that instalment as due today ? If you confirm the instalment will be marked as paid."),onAction:s=>{s&&this.updateInstalmentAsDue(this.instalment)}}),p.error(r.message||u("An unexpected error has occurred")).subscribe()}})}},mounted(){this.popupCloser(),this.order=this.popup.params.order,this.instalment=this.popup.params.instalment,this.fields=this.validation.createFields(this.fields)}},Dr={class:"shadow-lg ns-box w-95vw md:w-2/3-screen lg:w-1/3-screen"},Rr={class:"p-2 flex justify-between border-b items-center"},Ir={class:"p-2 ns-box-body"},qr=e("br",null,null,-1),$r={class:"border-t ns-box-footer p-2 flex justify-end"};function Qr(r,s,n,_,o,t){const b=h("ns-close-button"),l=h("ns-notice"),a=h("ns-field"),g=h("ns-button");return d(),c("div",Dr,[e("div",Rr,[e("h3",null,i(t.__("Payment Method")),1),e("div",null,[y(b,{onClick:s[0]||(s[0]=f=>t.close())})])]),e("div",Ir,[y(l,{color:"info",class:"py-2 p-4 text-center border text-primary rounded-lg"},{default:P(()=>[j(i(t.__("Before submitting the payment, choose the payment type used for that order.")),1)]),_:1}),qr,(d(!0),c(x,null,w(o.fields,(f,C)=>(d(),k(a,{key:C,field:f},null,8,["field"]))),128))]),e("div",$r,[y(g,{onClick:s[1]||(s[1]=f=>t.submitPayment()),type:"info"},{default:P(()=>[j(i(t.__("Submit Payment")),1)]),_:1})])])}const Nr=F(Tr,[["render",Qr]]),Yr={props:["order"],name:"ns-order-instalments",data(){return{labels:new N,original:[],instalments:[],print:new U({urls:systemUrls,options:systemOptions,type:"payment"})}},mounted(){this.loadInstalments()},computed:{totalInstalments(){return this.instalments.length>0?this.instalments.map(r=>r.amount).reduce((r,s)=>parseFloat(r)+parseFloat(s)):0}},methods:{__:u,nsCurrency:V,loadInstalments(){v.get(`/api/orders/${this.order.id}/instalments`).subscribe(r=>{this.original=r,this.instalments=r.map(s=>(s.price_clicked=!1,s.date_clicked=!1,s.date=moment(s.date).format("YYYY-MM-DD"),s))})},showReceipt(r){if(r.payment_id===null)return p.error(u("This instalment doesn't have any payment attached.")).subscribe();this.print.process(r.payment_id,"payment")},addInstalment(){this.instalments.push({date:ns.date.moment.format("YYYY-MM-DD"),amount:this.order.total-this.totalInstalments,paid:!1})},createInstalment(r){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to create this instalment ?"),onAction:s=>{s&&v.post(`/api/orders/${this.order.id}/instalments`,{instalment:r}).subscribe({next:n=>{this.loadInstalments(),p.success(n.message).subscribe()},error:n=>{p.error(n.message||u("An unexpected error has occurred")).subscribe()}})}})},deleteInstalment(r){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to delete this instalment ?"),onAction:s=>{s&&v.delete(`/api/orders/${this.order.id}/instalments/${r.id}`).subscribe({next:n=>{const _=this.instalments.indexOf(r);this.instalments.splice(_,1),p.success(n.message).subscribe()},error:n=>{p.error(n.message||u("An unexpected error has occurred")).subscribe()}})}})},async markAsPaid(r){try{const s=await new Promise((n,_)=>{Popup.show(Nr,{order:this.order,instalment:r,resolve:n,reject:_})});this.loadInstalments()}catch{}},togglePriceEdition(r){r.paid||(r.price_clicked=!r.price_clicked,this.$forceUpdate(),r.price_clicked&&setTimeout(()=>{this.$refs.amount[0].select()},100))},updateInstalment(r){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to update that instalment ?"),onAction:s=>{s&&v.put(`/api/orders/${this.order.id}/instalments/${r.id}`,{instalment:r}).subscribe({next:n=>{p.success(n.message).subscribe()},error:n=>{p.error(n.message||u("An unexpected error has occurred")).subscribe()}})}})},toggleDateEdition(r){r.paid||(r.date_clicked=!r.date_clicked,this.$forceUpdate(),r.date_clicked&&setTimeout(()=>{this.$refs.date[0].select()},200))}}},Br={class:"-mx-4 flex-auto flex flex-wrap"},Gr={class:"flex flex-auto"},Lr={class:"w-full mb-2 flex-wrap"},Er={class:"w-full mb-2 px-4"},Hr={class:"font-semibold text-secondary pb-2 border-b border-info-primary"},Mr={class:"px-4"},Wr={class:"border-table-th-edge border-t text-primary"},zr={class:"p-2"},Jr=["onClick"],Kr={key:1},Xr=["onBlur","onUpdate:modelValue"],Zr={class:"flex items-center"},en={class:"flex items-center px-2 h-full border-r"},sn=["onClick"],tn={key:1},rn=["onUpdate:modelValue","onBlur"],nn={key:0,class:"w-36 justify-center flex items-center px-2 h-full border-r"},on={class:"px-2"},ln={class:"px-2"},dn={class:"px-2"},an={key:1,class:"w-36 justify-center flex items-center px-2 h-full border-r"},cn={class:"px-2"},un={class:"ns-button info"},_n=["onClick"],mn=e("i",{class:"las la-plus"},null,-1),pn={key:2,class:"w-36 justify-center flex items-center px-2 h-full"},fn={class:"ns-button info"},hn=["onClick"],bn=e("i",{class:"las la-print"},null,-1),yn={class:"flex justify-between p-2 border-r border-b border-l elevation-surface"},vn={class:"flex items-center justify-center"},xn={class:"ml-1 text-sm"},wn={class:"-mx-2 flex flex-wrap items-center"},gn={class:"px-2"},kn={class:"px-2"},Pn={class:"ns-button info"};function Cn(r,s,n,_,o,t){const b=h("ns-icon-button");return d(),c("div",Br,[e("div",Gr,[e("div",Lr,[e("div",Er,[e("h3",Hr,i(t.__("Instalments")),1)]),e("div",Mr,[e("ul",Wr,[(d(!0),c(x,null,w(o.instalments,l=>(d(),c("li",{class:L([l.paid?"success":"info","border-b border-l flex justify-between elevation-surface"]),key:l.id},[e("span",zr,[l.date_clicked?m("",!0):(d(),c("span",{key:0,onClick:a=>t.toggleDateEdition(l)},i(l.date),9,Jr)),l.date_clicked?(d(),c("span",Kr,[D(e("input",{onBlur:a=>t.toggleDateEdition(l),"onUpdate:modelValue":a=>l.date=a,type:"date",ref_for:!0,ref:"date",class:"border border-info-primary rounded"},null,40,Xr),[[B,l.date]])])):m("",!0)]),e("div",Zr,[e("div",en,[l.price_clicked?m("",!0):(d(),c("span",{key:0,onClick:a=>t.togglePriceEdition(l)},i(t.nsCurrency(l.amount)),9,sn)),l.price_clicked?(d(),c("span",tn,[D(e("input",{ref_for:!0,ref:"amount","onUpdate:modelValue":a=>l.amount=a,onBlur:a=>t.togglePriceEdition(l),type:"text",class:"border border-info-primary p-1"},null,40,rn),[[B,l.amount]])])):m("",!0)]),!l.paid&&l.id?(d(),c("div",nn,[e("div",on,[y(b,{type:"success",onClick:a=>t.markAsPaid(l),className:"la-money-bill-wave-alt"},null,8,["onClick"])]),e("div",ln,[y(b,{type:"info",onClick:a=>t.updateInstalment(l),className:"la-save"},null,8,["onClick"])]),e("div",dn,[y(b,{type:"error",onClick:a=>t.deleteInstalment(l),className:"la-trash-alt"},null,8,["onClick"])])])):m("",!0),!l.paid&&!l.id?(d(),c("div",an,[e("div",cn,[e("div",un,[e("button",{onClick:a=>t.createInstalment(l),class:"px-3 py-1 rounded-full"},[mn,j(" "+i(t.__("Create")),1)],8,_n)])])])):m("",!0),l.paid?(d(),c("div",pn,[e("div",fn,[e("button",{onClick:a=>t.showReceipt(l),class:"px-3 text-xs py-1 rounded-full"},[bn,j(" "+i(t.__("Receipt")),1)],8,hn)])])):m("",!0)])],2))),128)),e("li",yn,[e("div",vn,[e("span",null,i(t.__("Total :"))+" "+i(t.nsCurrency(n.order.total)),1),e("span",xn," ("+i(t.__("Remaining :"))+" "+i(t.nsCurrency(n.order.total-t.totalInstalments))+") ",1)]),e("div",wn,[e("span",gn,i(t.__("Instalments:"))+" "+i(t.nsCurrency(t.totalInstalments)),1),e("span",kn,[e("div",Pn,[e("button",{onClick:s[0]||(s[0]=l=>t.addInstalment()),class:"rounded-full px-3 py-1"},i(t.__("Add Instalment")),1)])])])])])])])])])}const Sn=F(Yr,[["render",Cn]]),jn={name:"ns-orders-preview-popup",props:["popup"],data(){return{active:"details",order:new Object,rawOrder:new Object,products:[],payments:[],options:null,print:new U({urls:systemUrls,options:systemOptions}),settings:null}},components:{nsOrderRefund:Ze,nsOrderPayment:As,nsOrderDetails:Ur,nsOrderInstalments:Sn},computed:{isVoidable(){return["paid","partially_paid","unpaid"].includes(this.order.payment_status)},isDeleteAble(){return["hold"].includes(this.order.payment_status)}},methods:{__:u,popupResolver:q,popupCloser:I,nsCurrency:V,closePopup(r=!1){this.popupResolver(r)},setActive(r){this.active=r},printOrder(){this.print.process(this.order.id,"sale")},refresh(){this.loadOrderDetails(this.order.id)},loadOrderDetails(r){X([v.get(`/api/orders/${r}`),v.get(`/api/orders/${r}/products`),v.get(`/api/orders/${r}/payments`)]).subscribe(s=>{this.order=s[0],this.products=s[1],this.payments=s[2]})},deleteOrder(){Popup.show(O,{title:u("Confirm Your Action"),message:u("Would you like to delete this order"),onAction:r=>{r&&v.delete(`/api/orders/${this.order.id}`).subscribe({next:s=>{p.success(s.message).subscribe(),this.refreshCrudTable(),this.closePopup(!0)},error:s=>{p.error(s.message).subscribe()}})}})},voidOrder(){try{const r=new Promise((s,n)=>{Popup.show(K,{resolve:s,reject:n,title:u("Confirm Your Action"),message:u("The current order will be void. This action will be recorded. Consider providing a reason for this operation"),onAction:_=>{_!==!1&&v.post(`/api/orders/${this.order.id}/void`,{reason:_}).subscribe({next:o=>{p.success(o.message).subscribe(),this.refreshCrudTable(),this.closePopup(!0)},error:o=>{p.error(o.message).subscribe()}})}})})}catch(r){console.log(r)}},refreshCrudTable(){this.popup.params.component.$emit("updated",!0)}},watch:{active(){this.active==="details"&&this.loadOrderDetails(this.rawOrder.id)}},mounted(){this.rawOrder=this.popup.params.order,this.options=systemOptions,this.urls=systemUrls,this.loadOrderDetails(this.rawOrder.id),this.popupCloser()}},On={class:"h-95vh w-95vw md:h-6/7-screen md:w-6/7-screen overflow-hidden shadow-xl ns-box flex flex-col"},An={class:"border-b ns-box-header p-3 flex items-center justify-between"},Fn={class:"p-2 ns-box-body overflow-hidden flex flex-auto"},Vn={key:1,class:"h-full w-full flex items-center justify-center"},Un={class:"p-2 flex justify-between border-t ns-box-footer"},Tn=e("i",{class:"las la-ban"},null,-1),Dn=e("i",{class:"las la-trash"},null,-1),Rn=e("i",{class:"las la-print"},null,-1);function In(r,s,n,_,o,t){const b=h("ns-close-button"),l=h("ns-order-details"),a=h("ns-tabs-item"),g=h("ns-order-payment"),f=h("ns-order-refund"),C=h("ns-order-instalments"),E=h("ns-tabs"),H=h("ns-spinner"),$=h("ns-button");return d(),c("div",On,[e("div",An,[e("div",null,[e("h3",null,i(t.__("Order Options")),1)]),e("div",null,[y(b,{onClick:s[0]||(s[0]=S=>t.closePopup(!0))})])]),e("div",Fn,[o.order.id?(d(),k(E,{key:0,active:o.active,onActive:s[5]||(s[5]=S=>t.setActive(S))},{default:P(()=>[y(a,{label:t.__("Details"),identifier:"details",class:"overflow-y-auto"},{default:P(()=>[o.order?(d(),k(l,{key:0,order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["label"]),y(a,{visible:!["order_void","hold","refunded","partially_refunded"].includes(o.order.payment_status),label:t.__("Payments"),identifier:"payments"},{default:P(()=>[o.order?(d(),k(g,{key:0,onChanged:s[1]||(s[1]=S=>t.refresh()),order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["visible","label"]),y(a,{visible:!["order_void","hold","refunded"].includes(o.order.payment_status),label:t.__("Refund & Return"),identifier:"refund"},{default:P(()=>[o.order?(d(),k(f,{key:0,onLoadTab:s[2]||(s[2]=S=>t.setActive(S)),onChanged:s[3]||(s[3]=S=>t.refresh()),order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["visible","label"]),y(a,{visible:["partially_paid","unpaid"].includes(o.order.payment_status)&&o.order.support_instalments,label:t.__("Installments"),identifier:"instalments"},{default:P(()=>[o.order?(d(),k(C,{key:0,onChanged:s[4]||(s[4]=S=>t.refresh()),order:o.order},null,8,["order"])):m("",!0)]),_:1},8,["visible","label"])]),_:1},8,["active"])):m("",!0),o.order.id?m("",!0):(d(),c("div",Vn,[y(H)]))]),e("div",Un,[e("div",null,[t.isVoidable?(d(),k($,{key:0,onClick:s[6]||(s[6]=S=>t.voidOrder()),type:"error"},{default:P(()=>[Tn,j(" "+i(t.__("Void")),1)]),_:1})):m("",!0),t.isDeleteAble?(d(),k($,{key:1,onClick:s[7]||(s[7]=S=>t.deleteOrder()),type:"error"},{default:P(()=>[Dn,j(" "+i(t.__("Delete")),1)]),_:1})):m("",!0)]),e("div",null,[y($,{onClick:s[8]||(s[8]=S=>t.printOrder()),type:"info"},{default:P(()=>[Rn,j(" "+i(t.__("Print")),1)]),_:1})])])])}const Zn=F(jn,[["render",In]]);export{U as P,rt as a,Zn as n};
