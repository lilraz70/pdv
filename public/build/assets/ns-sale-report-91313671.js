import{h as w}from"./npm~moment-a9aaa855.js";import{c as C,e as T}from"./components-33a1bea5.js";import{a as x,b as p}from"./bootstrap-b8cd97d4.js";import{_ as d,n as k}from"./currency-dc6217f5.js";import{b as f}from"./ns-prompt-popup-4f52d15c.js";import{j as D}from"./join-array-567f2575.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import{an as F,af as n,G as _,H as t,c as v,A as h,F as m,al as b}from"./npm~@vue~runtime-core_-0a26b3ab.js";import{V as r}from"./npm~@vue~shared_-5bb087a6.js";import"./ns-alert-popup-f8b83fc1.js";import"./npm~numeral-304d6dd9.js";import"./npm~@ckeditor~ckeditor5-build-classic_-b5d88964.js";import"./npm~currency.js-57f74176.js";import"./npm~@vue~reactivity_-26e9e2f4.js";import"./ns-avatar-image-1c4f26a6.js";import"./npm~@dicebear~avatars_-24df7cd3.js";import"./npm~pure-color-28f75675.js";import"./npm~svgson-59868252.js";import"./npm~deep-rename-keys-9802c842.js";import"./npm~kind-of-f578382b.js";import"./npm~is-buffer-793dba8c.js";import"./npm~rename-keys-8dab041c.js";import"./npm~xml-reader-1f1b3f66.js";import"./npm~eventemitter3-e2795b41.js";import"./npm~xml-lexer-a4e87e97.js";import"./npm~@dicebear~avatars-avataaars-sprites_-796ded10.js";import"./npm~@vue~runtime-dom_-2c8e0ca9.js";import"./npm~vue2-daterange-picker-c3e32574.js";import"./npm~vuedraggable-45210012.js";import"./npm~vue-0182d78b.js";import"./npm~@vue~compiler-dom_-ce2c1e21.js";import"./npm~@vue~compiler-core_-745c8708.js";import"./npm~sortablejs-1952ed83.js";import"./npm~vue-upload-component-5c82cdcf.js";import"./npm~lodash-3db1c062.js";import"./npm~rxjs-eeb06f17.js";import"./npm~tslib-8dbab242.js";import"./npm~laravel-echo-0c2ba8ed.js";import"./npm~pusher-js-bd96ae31.js";import"./npm~axios-c24e582b.js";import"./npm~chart.js-3fed1729.js";import"./npm~rx-f450d610.js";import"./npm~@wordpress~hooks_-bd0b7221.js";import"./npm~mathjs-b10bd4cd.js";import"./npm~@babel~runtime_-9313f80d.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-dc0d19c5.js";import"./npm~fraction.js-cb0643cb.js";import"./npm~typed-function-de33f2d8.js";import"./npm~seedrandom-37239647.js";import"./npm~javascript-natural-sort-11e7fc54.js";import"./npm~escape-latex-404addb9.js";import"./npm~@ckeditor~ckeditor5-vue_-4438b480.js";const P={name:"ns-sale-report",data(){return{saleReport:"",startDateField:{name:"start_date",type:"datetime",value:ns.date.moment.startOf("day").format()},endDateField:{name:"end_date",type:"datetime",value:ns.date.moment.endOf("day").format()},result:[],users:[],ns:window.ns,summary:{},selectedUser:"",selectedCategory:"",reportType:{label:d("Report Type"),name:"reportType",type:"select",value:"categories_report",options:[{label:d("Categories Detailed"),name:"categories_report"},{label:d("Categories Summary"),name:"categories_summary"},{label:d("Products"),name:"products_report"}],description:d("Allow you to choose the report type.")},filterUser:{label:d("Filter User"),name:"filterUser",type:"select",value:"",options:[],description:d("Allow you to choose the report type.")},filterCategory:{label:d("Filter By Category"),name:"filterCategory",type:"multiselect",value:"",options:[],description:d("Allow you to choose the category.")},field:{type:"datetimepicker",value:"2021-02-07",name:"date"}}},components:{nsDatepicker:C,nsDateTimePicker:T},computed:{},methods:{__:d,nsCurrency:k,joinArray:D,printSaleReport(){this.$htmlToPaper("sale-report")},async openSettings(){try{const a=await new Promise((l,i)=>{Popup.show(f,{...this.reportType,resolve:l,reject:i})});this.reportType.value=a[0].name,this.result=[],this.loadReport()}catch{}},async openUserFiltering(){try{const a=await new Promise((l,i)=>{x.get("/api/users").subscribe({next:c=>{this.users=c,this.filterUser.options=[{label:d("All Users"),value:""},...this.users.map(s=>({label:s.username,value:s.id}))],Popup.show(f,{...this.filterUser,resolve:l,reject:i})},error:c=>{p.error(d("No user was found for proceeding the filtering.")),i(c)}})});this.selectedUser=a[0].label,this.filterUser.value=a[0].value,this.result=[],this.loadReport()}catch{}},async openCategoryFiltering(){try{let a=[];const l=await new Promise((i,c)=>{x.get("/api/categories").subscribe({next:s=>{a=s,this.filterCategory.options=[...s.map(e=>({label:e.name,value:e.id}))],Popup.show(f,{...this.filterCategory,resolve:i,reject:c})},error:s=>{p.error(d("No category was found for proceeding the filtering.")),c(s)}})});if(l.length>0){let i=a.filter(c=>l.includes(c.id)).map(c=>c.name);this.selectedCategory=this.joinArray(i),this.filterCategory.value=l}else this.selectedCategory="",this.filterCategory.value=[];this.result=[],this.loadReport()}catch(a){console.log(a)}},getType(a){const l=this.reportType.options.filter(i=>i.name===a);return l.length>0?l[0].label:d("Unknown")},loadReport(){if(this.startDate===null||this.endDate===null)return p.error(d("Unable to proceed. Select a correct time range.")).subscribe();const a=w(this.startDate);if(w(this.endDate).isBefore(a))return p.error(d("Unable to proceed. The current time range is not valid.")).subscribe();x.post("/api/reports/sale-report",{startDate:this.startDateField.value,endDate:this.endDateField.value,type:this.reportType.value,user_id:this.filterUser.value,categories_id:this.filterCategory.value}).subscribe({next:i=>{this.result=i.result,this.summary=i.summary},error:i=>{p.error(i.message).subscribe()}})},computeTotal(a,l){return a.length>0?a.map(i=>parseFloat(i[l])).reduce((i,c)=>i+c):0}},props:["storeLogo","storeName"],mounted(){}},S={id:"report-section",class:"px-4"},R={class:"flex -mx-2"},B={class:"px-2"},A={class:"px-2"},N={class:"px-2"},j=t("i",{class:"las la-sync-alt text-xl"},null,-1),L={class:"pl-2"},q={class:"flex -mx-2"},M={class:"px-2"},V=t("i",{class:"las la-print text-xl"},null,-1),H={class:"pl-2"},Q={class:"px-2"},O=t("i",{class:"las la-filter text-xl"},null,-1),E={class:"pl-2"},G={class:"px-2"},I=t("i",{class:"las la-filter text-xl"},null,-1),z={class:"pl-2"},J={class:"px-2"},K=t("i",{class:"las la-filter text-xl"},null,-1),W={class:"pl-2"},X={id:"sale-report",class:"anim-duration-500 fade-in-entrance"},Y={class:"flex w-full"},Z={class:"my-4 flex justify-between w-full"},$={class:"text-secondary"},tt=["innerHTML"],et={class:"pb-1 border-b border-dashed"},rt={class:"pb-1 border-b border-dashed"},st=["src","alt"],ot={class:"-mx-4 flex md:flex-row flex-col"},lt={class:"w-full md:w-1/2 px-4"},it={class:"shadow rounded my-4 ns-box"},at={class:"border-b ns-box-body"},dt={class:"table ns-table w-full"},ct={class:"text-primary"},nt={class:""},_t={width:"200",class:"font-semibold p-2 border text-left bg-info-secondary border-info-primary text-white"},ut={class:"p-2 border text-right border-info-primary"},pt={class:""},ht={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},mt={class:"p-2 border text-right border-error-primary"},bt={class:""},yt={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},xt={class:"p-2 border text-right border-error-primary"},ft={key:0,class:""},gt={width:"200",class:"font-semibold p-2 border text-left bg-error-secondary border-error-primary text-white"},wt={class:"p-2 border text-right border-error-primary"},vt={class:""},Ct={width:"200",class:"font-semibold p-2 border text-left bg-info-secondary border-info-primary text-white"},Tt={class:"p-2 border text-right border-success-primary"},kt={class:""},Dt={width:"200",class:"font-semibold p-2 border text-left bg-success-secondary border-success-secondary text-white"},Ut={class:"p-2 border text-right border-success-primary"},Ft=t("div",{class:"w-full md:w-1/2 px-4"},null,-1),Pt={key:0,class:"bg-box-background shadow rounded my-4"},St={class:"border-b border-box-edge"},Rt={class:"table ns-table w-full"},Bt={class:"text-primary"},At={class:"border p-2 text-left"},Nt={width:"150",class:"border p-2"},jt={width:"150",class:"border p-2"},Lt={width:"150",class:"border p-2"},qt={width:"150",class:"border p-2"},Mt={class:"text-primary"},Vt={class:"p-2 border"},Ht={class:"p-2 border text-right"},Qt={class:"p-2 border text-right"},Ot={class:"p-2 border text-right"},Et={class:"p-2 border text-right"},Gt={class:"text-primary font-semibold"},It=t("td",{class:"p-2 border text-primary"},null,-1),zt={class:"p-2 border text-right text-primary"},Jt={class:"p-2 border text-right text-primary"},Kt={class:"p-2 border text-right text-primary"},Wt={class:"p-2 border text-right text-primary"},Xt={key:1,class:"bg-box-background shadow rounded my-4"},Yt={class:"border-b border-box-edge"},Zt={class:"table ns-table w-full"},$t={class:"text-primary"},te={class:"border p-2 text-left"},ee={class:"border p-2 text-left"},re={width:"100",class:"border p-2"},se={width:"150",class:"border p-2"},oe={width:"150",class:"border p-2"},le={width:"150",class:"border p-2"},ie={width:"150",class:"border p-2"},ae={width:"150",class:"border p-2"},de={class:"text-primary"},ce={class:"p-2 border"},ne={class:"p-2 border"},_e={class:"p-2 border text-right"},ue={class:"p-2 border text-right"},pe={class:"p-2 border text-right"},he={class:"p-2 border text-right"},me={class:"p-2 border text-right"},be={class:"p-2 border text-right"},ye={class:"bg-info-primary"},xe={colspan:"2",class:"p-2 border border-info-secondary"},fe={class:"p-2 border text-right border-info-secondary"},ge={class:"p-2 border text-right border-info-secondary"},we={class:"p-2 border text-right border-info-secondary"},ve={class:"p-2 border text-right border-info-secondary"},Ce={class:"p-2 border text-right border-info-secondary"},Te={class:"p-2 border text-right border-info-secondary"},ke={class:"text-primary font-semibold"},De=t("td",{colspan:"2",class:"p-2 border text-primary"},null,-1),Ue={class:"p-2 border text-right text-primary"},Fe={class:"p-2 border text-right text-primary"},Pe={class:"p-2 border text-right text-primary"},Se={class:"p-2 border text-right text-primary"},Re={class:"p-2 border text-right text-primary"},Be={class:"p-2 border text-right text-primary"},Ae={key:2,class:"bg-box-background shadow rounded my-4"},Ne={class:"border-b border-box-edge"},je={class:"table ns-table w-full"},Le={class:"text-primary"},qe={class:"border p-2 text-left"},Me={width:"100",class:"border p-2"},Ve={width:"150",class:"border p-2"},He={width:"150",class:"border p-2"},Qe={width:"150",class:"border p-2"},Oe={class:"text-primary"},Ee={class:"p-2 border text-left border-info-primary"},Ge={class:"p-2 border text-right border-info-primary"},Ie={class:"p-2 border text-right border-info-primary"},ze={class:"p-2 border text-right border-info-primary"},Je={class:"p-2 border text-right border-info-primary"},Ke={class:"text-primary font-semibold"},We=t("td",{class:"p-2 border text-primary"},null,-1),Xe={class:"p-2 border text-right text-primary"},Ye={class:"p-2 border text-right text-primary"},Ze={class:"p-2 border text-right text-primary"},$e={class:"p-2 border text-right text-primary"};function tr(a,l,i,c,s,e){const g=F("ns-date-time-picker");return n(),_("div",S,[t("div",R,[t("div",B,[v(g,{field:s.startDateField},null,8,["field"])]),t("div",A,[v(g,{field:s.endDateField},null,8,["field"])]),t("div",N,[t("button",{onClick:l[0]||(l[0]=o=>e.loadReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[j,t("span",L,r(e.__("Load")),1)])])]),t("div",q,[t("div",M,[t("button",{onClick:l[1]||(l[1]=o=>e.printSaleReport()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[V,t("span",H,r(e.__("Print")),1)])]),t("div",Q,[t("button",{onClick:l[2]||(l[2]=o=>e.openSettings()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[O,t("span",E,r(e.__("By Type"))+" : "+r(e.getType(s.reportType.value)),1)])]),t("div",G,[t("button",{onClick:l[3]||(l[3]=o=>e.openUserFiltering()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[I,t("span",z,r(e.__("By User"))+" : "+r(s.selectedUser||e.__("All Users")),1)])]),t("div",J,[t("button",{onClick:l[4]||(l[4]=o=>e.openCategoryFiltering()),class:"rounded flex justify-between bg-input-button shadow py-1 items-center text-primary px-2"},[K,t("span",W,r(e.__("By Category"))+" : "+r(s.selectedCategory||e.__("All Category")),1)])])]),t("div",X,[t("div",Y,[t("div",Z,[t("div",$,[t("ul",null,[t("li",{class:"pb-1 border-b border-dashed",innerHTML:e.__("Range : {date1} — {date2}").replace("{date1}",s.startDateField.value).replace("{date2}",s.endDateField.value)},null,8,tt),t("li",et,r(e.__("Document : Sale Report")),1),t("li",rt,r(e.__("By : {user}").replace("{user}",s.ns.user.username)),1)])]),t("div",null,[t("img",{class:"w-24",src:i.storeLogo,alt:i.storeName},null,8,st)])])]),t("div",null,[t("div",ot,[t("div",lt,[t("div",it,[t("div",at,[t("table",dt,[t("tbody",ct,[t("tr",nt,[t("td",_t,r(e.__("Sub Total")),1),t("td",ut,r(e.nsCurrency(s.summary.subtotal)),1)]),t("tr",pt,[t("td",ht,r(e.__("Sales Discounts")),1),t("td",mt,r(e.nsCurrency(s.summary.sales_discounts)),1)]),t("tr",bt,[t("td",yt,r(e.__("Sales Taxes")),1),t("td",xt,r(e.nsCurrency(s.summary.sales_taxes)),1)]),s.summary.product_taxes>0?(n(),_("tr",ft,[t("td",gt,r(e.__("Product Taxes")),1),t("td",wt,r(e.nsCurrency(s.summary.product_taxes)),1)])):h("",!0),t("tr",vt,[t("td",Ct,r(e.__("Shipping")),1),t("td",Tt,r(e.nsCurrency(s.summary.shipping)),1)]),t("tr",kt,[t("td",Dt,r(e.__("Total")),1),t("td",Ut,r(e.nsCurrency(s.summary.total)),1)])])])])])]),Ft])]),s.reportType.value==="products_report"?(n(),_("div",Pt,[t("div",St,[t("table",Rt,[t("thead",Bt,[t("tr",null,[t("th",At,r(e.__("Products")),1),t("th",Nt,r(e.__("Quantity")),1),t("th",jt,r(e.__("Discounts")),1),t("th",Lt,r(e.__("Taxes")),1),t("th",qt,r(e.__("Total")),1)])]),t("tbody",Mt,[(n(!0),_(m,null,b(s.result,o=>(n(),_("tr",{key:o.id},[t("td",Vt,r(o.name),1),t("td",Ht,r(o.quantity),1),t("td",Qt,r(e.nsCurrency(o.discount)),1),t("td",Ot,r(e.nsCurrency(o.tax_value)),1),t("td",Et,r(e.nsCurrency(o.total_price)),1)]))),128))]),t("tfoot",Gt,[t("tr",null,[It,t("td",zt,r(e.computeTotal(s.result,"quantity")),1),t("td",Jt,r(e.nsCurrency(e.computeTotal(s.result,"discount"))),1),t("td",Kt,r(e.nsCurrency(e.computeTotal(s.result,"tax_value"))),1),t("td",Wt,r(e.nsCurrency(e.computeTotal(s.result,"total_price"))),1)])])])])])):h("",!0),s.reportType.value==="categories_report"?(n(),_("div",Xt,[t("div",Yt,[t("table",Zt,[t("thead",$t,[t("tr",null,[t("th",te,r(e.__("Category")),1),t("th",ee,r(e.__("Product")),1),t("th",re,r(e.__("Quantity")),1),t("th",se,r(e.__("Discounts")),1),t("th",oe,r(e.__("Taxes")),1),t("th",le,r(e.__("Total")),1),t("th",ie,r(e.__("Purchase Price")),1),t("th",ae,r(e.__("Profit")),1)])]),t("tbody",de,[(n(!0),_(m,null,b(s.result,(o,y)=>(n(),_(m,{key:y},[o.products.length>0?(n(!0),_(m,{key:0},b(o.products,u=>(n(),_("tr",{key:parseInt(o.id+""+u.id)},[t("td",ce,r(o.name),1),t("td",ne,r(u.name),1),t("td",_e,r(u.quantity),1),t("td",ue,r(e.nsCurrency(u.discount)),1),t("td",pe,r(e.nsCurrency(u.tax_value)),1),t("td",he,r(e.nsCurrency(u.total_price)),1),t("td",me,r(e.nsCurrency(u.total_purchase_price)),1),t("td",be,r(e.nsCurrency(u.total_price-(u.total_purchase_price+u.tax_value+u.discount))),1)]))),128)):h("",!0),t("tr",ye,[t("td",xe,r(o.name),1),t("td",fe,r(e.computeTotal(o.products,"quantity")),1),t("td",ge,r(e.nsCurrency(e.computeTotal(o.products,"discount"))),1),t("td",we,r(e.nsCurrency(e.computeTotal(o.products,"tax_value"))),1),t("td",ve,r(e.nsCurrency(e.computeTotal(o.products,"total_price"))),1),t("td",Ce,r(e.nsCurrency(e.computeTotal(o.products,"total_purchase_price"))),1),t("td",Te,r(e.nsCurrency(e.computeTotal(o.products,"total_price")-(e.computeTotal(o.products,"total_purchase_price")+e.computeTotal(o.products,"tax_value")+e.computeTotal(o.products,"discount")))),1)])],64))),128))]),t("tfoot",ke,[t("tr",null,[De,t("td",Ue,r(e.computeTotal(s.result,"total_sold_items")),1),t("td",Fe,r(e.nsCurrency(e.computeTotal(s.result,"total_discount"))),1),t("td",Pe,r(e.nsCurrency(e.computeTotal(s.result,"total_tax_value"))),1),t("td",Se,r(e.nsCurrency(e.computeTotal(s.result,"total_price"))),1),t("td",Re,r(e.nsCurrency(e.computeTotal(s.result,"total_purchase_price"))),1),t("td",Be,r(e.nsCurrency(e.computeTotal(s.result,"total_price")-(e.computeTotal(s.result,"total_purchase_price")+e.computeTotal(s.result,"total_discount")+e.computeTotal(s.result,"total_tax_value")))),1)])])])])])):h("",!0),s.reportType.value==="categories_summary"?(n(),_("div",Ae,[t("div",Ne,[t("table",je,[t("thead",Le,[t("tr",null,[t("th",qe,r(e.__("Category")),1),t("th",Me,r(e.__("Quantity")),1),t("th",Ve,r(e.__("Discounts")),1),t("th",He,r(e.__("Taxes")),1),t("th",Qe,r(e.__("Total")),1)])]),t("tbody",Oe,[(n(!0),_(m,null,b(s.result,(o,y)=>(n(),_("tr",{key:y,class:""},[t("td",Ee,r(o.name),1),t("td",Ge,r(e.computeTotal(o.products,"quantity")),1),t("td",Ie,r(e.nsCurrency(e.computeTotal(o.products,"discount"))),1),t("td",ze,r(e.nsCurrency(e.computeTotal(o.products,"tax_value"))),1),t("td",Je,r(e.nsCurrency(e.computeTotal(o.products,"total_price"))),1)]))),128))]),t("tfoot",Ke,[t("tr",null,[We,t("td",Xe,r(e.computeTotal(s.result,"total_sold_items")),1),t("td",Ye,r(e.nsCurrency(e.computeTotal(s.result,"total_discount"))),1),t("td",Ze,r(e.nsCurrency(e.computeTotal(s.result,"total_tax_value"))),1),t("td",$e,r(e.nsCurrency(e.computeTotal(s.result,"total_price"))),1)])])])])])):h("",!0)])])}const ts=U(P,[["render",tr]]);export{ts as default};
